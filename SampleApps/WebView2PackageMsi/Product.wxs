<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
	<Product Id="*" Name="WebView2PackageMsi" Language="1033" Version="1.0.0.0" Manufacturer="Microsoft Corp." UpgradeCode="747c5e4c-5e28-4fbf-b7ba-f382b55dd9c4">
		<Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine"/>
		<MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed."/>
    <MediaTemplate EmbedCab="yes"/>
        
		<!-- Step 1: Define installation folder -->
		<Directory Id="TARGETDIR" Name="SourceDir">
			<Directory Id="ProgramFiles64Folder">
				<Directory Id="INSTALLFOLDER" Name="WebView2PackageMsi"/>
			</Directory>
		</Directory>
		
		<!-- Step 2: Add files to your installer package -->
		<DirectoryRef Id="INSTALLFOLDER">
			<Component Id="WebView2APISample.exe" Guid="2DC56D26-A5CC-40ED-81C5-441042F2C46B">
				<File Id="WebView2APISample.exe" Source="..\WebView2APISample\Debug\x64\WebView2APISample.exe" KeyPath="yes" Checksum="yes"/>
			</Component>
			<Component Id="WebView2Loader.dll" Guid="624B4B28-4D7F-49D8-9CAD-279FC2AC8D25">
				<File Id="WebView2Loader.dll" Source="..\WebView2APISample\Debug\x64\WebView2Loader.dll" KeyPath="yes"/>
			</Component>
			<!-- [Package Bootstrapper] Package bootstrapper with your app -->
			<!--<Component Id="MicrosoftEdgeWebview2Setup.exe" Guid="777B0F5C-51C3-4A39-AC5A-88E5A2640D48">
				<File Id="MicrosoftEdgeWebview2Setup.exe" Source="..\WebView2APISample\Debug\x86\MicrosoftEdgeWebview2Setup.exe" KeyPath="yes"/>
			</Component>-->
		</DirectoryRef>

		<!-- Step 3: Tell WiX to install the files -->
		<Feature Id="MainApplication" Title="Main Application" Level="1" ConfigurableDirectory='INSTALLFOLDER'>
			<ComponentRef Id="WebView2APISample.exe"/>
			<ComponentRef Id="WebView2Loader.dll"/>
      
			<!-- [Package Bootstrapper] Package bootstrapper with your app -->
			<!--<ComponentRef Id="MicrosoftEdgeWebview2Setup.exe" />-->
		</Feature>

		<!--Custom UI. Let User choose install location-->
		<Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER"/>
		<UIRef Id="WixUI_InstallDir"/>

		<!-- [Package Bootstrapper] Package bootstrapper then invoke at app installation-->
		<!--<CustomAction Id='InvokeBootstrapper' FileKey='MicrosoftEdgeWebview2Setup.exe' Execute="deferred" Impersonate="no" ExeCommand=' ' Return='check' />-->
		
		<!-- [Download Bootstrapper] Use fwlink to download bootstrapper to user TEMP folder then invoke it-->
		<Property Id='POWERSHELL'>powershell.exe</Property>
		<CustomAction Id='DownloadBootstrapper' Property='POWERSHELL' ExeCommand='Invoke-WebRequest -Uri "http://ie-snap/scratchtests/xiaqu/MicrosoftEdgeWebview2Setup.exe" -OutFile "$env:TEMP\MicrosoftEdgeWebview2Setup.exe"' Return='check'/>
		<CustomAction Id='InvokeBootstrapper' Directory="INSTALLFOLDER" Execute="deferred" Impersonate="no" ExeCommand='cmd.exe /c %temp%\MicrosoftEdgeWebview2Setup.exe /silent /install' Return='check'/>
		
		<!-- Custom action to invoke for download and install bootstrapper -->
		<InstallExecuteSequence>
			<!-- [Package Bootstrapper] Package bootstrapper and invoke at app installation-->
			<!--<Custom Action='LaunchFile' Before='InstallFinalize'/>-->

			<!-- [Download Bootstrapper] Use fwlink to download the bootstrapper to user TEMP folder and invoke-->
			<Custom Action='DownloadBootstrapper' Before='InstallFinalize'/>
			<Custom Action='InvokeBootstrapper' After='DownloadBootstrapper'/>
		</InstallExecuteSequence>
	</Product>
</Wix>
